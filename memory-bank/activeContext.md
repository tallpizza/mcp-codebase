# 활성 컨텍스트

## 현재 상태

1. **서버 구성**

   - MCP 프로토콜 기반 서버 구현
   - stdio 전송 계층 사용
   - 도구 기반 기능 제공

2. **데이터베이스**

   - PostgreSQL + pgvector 사용
   - Drizzle ORM으로 데이터 액세스
   - 프로젝트 및 코드 청크 테이블 구현
   - 프로젝트 테이블에 lastCommitHash 필드 추가

3. **도구 및 CLI 구현**
   - 파일 처리 도구
   - 코드 분석 도구
   - CLI 명령어 파서 및 실행 기능
   - 프로젝트 생성/조회 명령 구현
   - 프로젝트 관리 서비스 구현
   - 프로젝트 삭제 명령어 구현

## 최근 변경사항

1. **CLI 확장 구현**

   - 독립적인 CLI 명령어 파서 모듈 구현 (`src/cli/index.ts`)
   - `create-project`, `list-projects`, `analyze-project`, `delete-project` 명령 추가
   - 사용자 친화적인 도움말 및 예제 포함
   - 인자 파싱 및 검증 기능 구현

2. **프로젝트 ID 전달 방식 변경**

   - 명령줄 인자(`--project_id`) 대신 환경변수(`PROJECT_ID`) 사용
   - `getProjectId` 함수 제거
   - 환경변수 기반 실행으로 일관성 향상
   - CLI 명령어와 서버 모드 간 통일된 방식 적용

3. **Git 통합 기능 추가**

   - Git 서비스 구현 (`src/services/gitService.ts`)
   - 로컬 Git 저장소 커밋 해시 추적
   - 프로젝트별 마지막 분석 커밋 저장
   - 커밋 간 변경된 파일 감지 기능

4. **선택적 코드 재분석 구현**

   - 변경된 파일만 선택적으로 재분석하는 기능 추가
   - 마지막 분석 이후 변경사항 감지
   - 변경된 파일 목록 필터링
   - 성능 최적화 및 불필요한 처리 감소

5. **아키텍처 리팩토링**
   - 프로젝트 도구를 서비스로 변경
   - MCP에서 프로젝트 도구 제거
   - CLI를 통해서만 프로젝트 관리 가능하도록 변경
   - 명확한 관심사 분리를 통한 구조 개선

## 진행 중인 구현

1. **프로젝트 서비스 기능 확장**

   - 프로젝트 삭제 기능 구현 완료
   - 프로젝트 및 관련 코드 청크 삭제 기능 추가
   - 무분별한 삭제 방지를 위한 확인 메커니즘 구현
   - 삭제 실패 시 적절한 오류 처리

2. **CLI 문서화 강화**
   - README.md에 CLI 사용법 추가
   - 프로젝트 관리 및 MCP 서버 모드 실행 방법 문서화
   - 환경변수 기반 실행 방법 설명
   - 명령어별 사용 예제 제공

## 다음 단계

1. **CLI 기능 추가 확장**

   - 프로젝트 상태 확인 명령 추가
   - 사용자 설정 및 환경 구성 명령 도입
   - 대화형 모드 구현 검토

2. **Git 통합 강화**

   - 원격 Git 저장소 지원 추가
   - 브랜치별 분석 기능 구현
   - 복잡한 변경사항 처리 개선

3. **성능 최적화**
   - 임베딩 생성 병렬화
   - 캐싱 전략 구현
   - 벡터 검색 성능 향상

## 활성 결정사항

1. **아키텍처**

   - MCP 프로토콜 기반 설계
   - 계층형 아키텍처 채택
   - 모듈식 서비스 및 CLI 구현
   - 프로젝트 기능 MCP 도구에서 분리

2. **데이터 관리**

   - PostgreSQL 사용
   - Drizzle ORM 활용
   - 벡터 기반 검색 구현
   - Git 변경사항 추적

3. **개발 방식**
   - TypeScript 사용
   - 서비스 기반 기능 구현
   - CLI 및 서버 모드 분리
   - 환경변수 기반 구성

## 고려사항

1. **확장성**

   - 새로운 CLI 명령 추가 용이성
   - 데이터베이스 스키마 확장
   - 성능 스케일링

2. **보안**

   - 환경 변수 관리
   - 데이터베이스 접근 제어
   - 오류 메시지 보안

3. **유지보수**
   - 코드 문서화
   - 로깅 전략
   - 모니터링 구현
